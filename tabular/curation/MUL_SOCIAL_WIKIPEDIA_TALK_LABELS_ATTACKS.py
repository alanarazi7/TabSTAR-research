from tabular.datasets.manual_curation_obj import CuratedFeature, CuratedTarget
from tabular.preprocessing.objects import SupervisedTask

'''
Dataset Name: Wikipedia_Talk_Labels
====
Examples: 855514
====
URL: https://www.openml.org/search?type=data&id=46708
====
Description: This data set includes over 100k labeled discussion comments from English Wikipedia. Each comment was labeled by multiple annotators via Crowdflower on whether it contains a personal attack. We also include some demographic data for each crowd-worker. See our wiki for documentation of the schema of each file and our research paper for documentation on the data collection and modeling methodology. For a quick demo of how to use the data for model building and analysis, check out this ipython notebook.

This is originally a multi-label classification problem. However, for the purpose of this task, we have combined the labels into a single column.

Create a Multiclass Target Column: Encode the attack labels (recipient_attack,third_party_attack,attack, etc.) as a single class. 

# Combine labels into a single column
def encode_multiclass(row):
    return ','.join(row.index[row == 1])

Here, each combination of the labels results in a unique class. For example, a comment with the labels recipient_attack and third_party_attack will have a class of recipient_attack,third_party_attack.
And so on.

Drop Original Labels after creating the class column.

We created the final dataset by merging the three datasets attack_annotated_comments.tsv, attack_annotations.tsv, and attack_worker_demographics.tsv. This is the order
we followed to merge the datasets:
1. Merge attack_annotated_comments.tsv with attack_annotations.tsv on 'rev_id'
2. Merge the resultant dataset with attack_worker_demographics.tsv on 'worker_id'

paper_url = "https://arxiv.org/pdf/1610.08914"

original_data_url = "https://figshare.com/articles/dataset/Wikipedia_Talk_Labels_Personal_Attacks/4054689"
====
Target Variable: class (string, 15 distinct): ['recipient_attack,attack', 'other_attack,attack', 'third_party_attack,attack', 'recipient_attack,third_party_attack,attack', 'quoting_attack,attack', 'recipient_attack,other_attack,attack', 'quoting_attack,recipient_attack,third_party_attack,other_attack,attack', 'third_party_attack,other_attack,attack', 'quoting_attack,recipient_attack,third_party_attack,attack', 'recipient_attack,third_party_attack,other_attack,attack']
====
Features:

rev_id (numeric, 115846 distinct): ['282042816', '30264734', '193310003', '340063809', '30266565', '289332976', '533775878', '81092174', '499617263', '466318819']
comment (string, 115687 distinct): ['`NEWLINE_TOKEN==The Graceful Slick....==NEWLINE_TOKENIs non other than an ungraceful dick!  `', "`NEWLINE_TOKEN{| width=``100%`` style=``background:transparent``NEWLINE_TOKEN{| width=``100%`` style=``background-color:#F5FFFA``NEWLINE_TOKEN|style=``width: 50%; border:1px solid #084080; background-color:#F5FFFA; vertical-align:top``|NEWLINE_TOKEN{| width=``100%`` cellpadding=``2`` style=``vertical-align:top; background-color:#F5FFFA``NEWLINE_TOKEN| Hello, , and Welcome to Wikipedia!NEWLINE_TOKENPlease remember to sign your name on talk pages by clicking  or  or by typing four tildes (~~~~); this will automatically produce your username and the date. Also, please do your best to always fill in the edit summary field. Below are some useful links to facilitate your involvement.NEWLINE_TOKENHappy editing!   NEWLINE_TOKEN|}NEWLINE_TOKEN{| width=``100%`` style=``background-color:#F5FFFA``NEWLINE_TOKEN|style=``width: 50%; border:0; background-color:#F5FFFA; vertical-align:top``|NEWLINE_TOKEN{| width=``100%`` cellpadding=``2`` style=``vertical-align:top; background-color:#F5FFFA;``NEWLINE_TOKEN|-NEWLINE_TOKEN! Getting startedNEWLINE_TOKEN|-NEWLINE_TOKEN|style=``color:#000``|NEWLINE_TOKEN* IntroductionNEWLINE_TOKEN* The five pillars of WikipediaNEWLINE_TOKEN* How to edit a pageNEWLINE_TOKEN* Intuitive guide to WikipediaNEWLINE_TOKEN|-NEWLINE_TOKEN! Finding your way aroundNEWLINE_TOKEN|-NEWLINE_TOKEN| style=``color:#000``|NEWLINE_TOKEN* Table of contentsNEWLINE_TOKEN* Department directoryNEWLINE_TOKEN|-NEWLINE_TOKEN! Editing articlesNEWLINE_TOKEN|-NEWLINE_TOKEN| style=``color:#000``|NEWLINE_TOKEN* How to develop an articleNEWLINE_TOKEN* Manual of StyleNEWLINE_TOKEN|-NEWLINE_TOKEN|}NEWLINE_TOKEN|style=``width: 50%; border:0; background-color:#F5FFFA; vertical-align:top``|NEWLINE_TOKEN{| width=``100%`` cellpadding=``2`` style=``vertical-align:top; background-color:#F5FFFA``NEWLINE_TOKEN! Getting helpNEWLINE_TOKEN|-NEWLINE_TOKEN|style=``color:#000``|NEWLINE_TOKEN* Frequently asked questionsNEWLINE_TOKEN* CheatsheetNEWLINE_TOKEN* Where to ask a questionNEWLINE_TOKEN* Help pagesNEWLINE_TOKEN* New contributors' help pageNEWLINE_TOKEN* Article Wizard – a Wizard to help you create articlesNEWLINE_TOKEN|-NEWLINE_TOKEN! How you can helpNEWLINE_TOKEN|-NEWLINE_TOKEN|style=``color:#000``|NEWLINE_TOKEN* Contributing to WikipediaNEWLINE_TOKEN* Community PortalNEWLINE_TOKEN* Join a WikiProjectNEWLINE_TOKEN* Follow Wikipedia etiquetteNEWLINE_TOKEN* Practice civilityNEWLINE_TOKEN|-NEWLINE_TOKEN|}NEWLINE_TOKEN|}NEWLINE_TOKEN|}NEWLINE_TOKEN|}`", 'Thank you for experimenting with  Wikipedia. Your test worked, and it has been reverted or removed. Please use the sandbox for any other tests you may want to do. Take a look at the welcome page to learn more about contributing to our encyclopedia.   ', 'Thank you for experimenting with  Wikipedia. Your test worked, and it has been reverted or removed. Please use the sandbox for any other tests you may want to do. Take a look at the welcome page to learn more about contributing to our encyclopedia.    ', 'NEWLINE_TOKENWelcome!NEWLINE_TOKENNEWLINE_TOKENHello, , and welcome to Wikipedia! Thank you for your contributions. I hope you like the place and decide to stay. Here are a few good links for newcomers:NEWLINE_TOKEN*The five pillars of WikipediaNEWLINE_TOKEN*How to edit a pageNEWLINE_TOKEN*Help pagesNEWLINE_TOKEN*TutorialNEWLINE_TOKEN*How to write a great articleNEWLINE_TOKEN*Manual of StyleNEWLINE_TOKENI hope you enjoy editing here and being a Wikipedian! Please sign your name on talk pages using four tildes (~~~~); this will automatically produce your name and the date. If you need help, check out Wikipedia:Questions, ask me on my talk page, or place {{helpme}} on your talk page and someone will show up shortly to answer your questions. Again, welcome!\xa0  ', 'NEWLINE_TOKENNEWLINE_TOKEN== NOTICE OF WITHDRAWAL ==NEWLINE_TOKENNEWLINE_TOKEN:I am writing this message to you as a notice of my withdrawal from Wikipedia following the recent events/edits on the CNN and Susan Roesgen pages – events that you were involved in.  Never in all of my years in academia (the better part of a decade) have I been privy to such patently-insincere and downright academically-fraudulent work as that which I have encountered on Wikipedia.NEWLINE_TOKEN:While I was initially willing to set aside all of the negative things I had heard about Wikipedia in an effort to contribute to a seemingly beneficial project, the actions of editors and administrators on the  Susan Roesgen and CNN pages has made it eminently clear that “scholarship” and Wikipedia truly are mutually exclusive – propaganda has carried the day.NEWLINE_TOKEN:My failure to grace the project with some actual academically-sound work was not made in vain; with every neutral editor that you drive out of the project with your blatantly POV-pushing agenda, you further bolster your reputation as nothing but an unreliable propaganda board. Your reputation for unreliability was perhaps best captured in a recent statement made by my corporations professor: “I decided to make myself more ignorant on the topic by looking at the article (Dodge v. Ford Motor Company) on Wikipedia.”NEWLINE_TOKEN:I strongly encourage you to alter your course, set aside your agenda, and reverse your – and Wikipedia’s – reputation as a laughing stock. This will not only benefit the public in general, but will, I submit, actually make you feel better about yourself. Best, J.M.  ', "`NEWLINE_TOKENNEWLINE_TOKEN== Could you please comment on Talk:Thought_identification ==NEWLINE_TOKENNEWLINE_TOKENRe: John Norseen and Lockheed MartinNEWLINE_TOKENNEWLINE_TOKENI'm beside myself trying to update information that I believe to be very relevent.  It looks to me like several users who ``hang out`` at ``ANI:Fringe`` are working together to remove well sourced, valid, on topic material which shows the state of military research into thought identification.  Outside comments would be greatly appreciated.  Thanks.NEWLINE_TOKEN  `", "NEWLINE_TOKENNEWLINE_TOKEN== Merry Christmas from the Jimbo Loving Troll! ==NEWLINE_TOKENNEWLINE_TOKENI bring you seasonal tidings of good cheerNEWLINE_TOKENNEWLINE_TOKENBut at the same time your talk page should fearNEWLINE_TOKENNEWLINE_TOKENA similar fate to the Graceful Slick'sNEWLINE_TOKENNEWLINE_TOKENCome Anno Dommini Two Thousand, Ten, And Six   ", '`NEWLINE_TOKENWelcome!NEWLINE_TOKENNEWLINE_TOKENHello, , and welcome to Wikipedia! Thank you for your contributions. I hope you like the place and decide to stay. Here are some pages that you might find helpful:NEWLINE_TOKEN*The five pillars of WikipediaNEWLINE_TOKEN*How to edit a pageNEWLINE_TOKEN*Help pagesNEWLINE_TOKEN*TutorialNEWLINE_TOKEN*How to write a great articleNEWLINE_TOKEN*Manual of StyleNEWLINE_TOKENI hope you enjoy editing here and being a Wikipedian! Please sign your name on talk pages using four tildes (~~~~); this will automatically produce your name and the date. If you need help, check out Wikipedia:Questions, ask me on my talk page, or place {{helpme}} on your talk page and someone will show up shortly to answer your questions. Again, welcome!\xa0  `', "NEWLINE_TOKENWelcomeNEWLINE_TOKENNEWLINE_TOKENHello and welcome to Wikipedia.  We appreciate encyclopedic contributions, but some of your recent contributions seem to be advertising or for promotional purposes.  Wikipedia does not allow advertising in articles.  For more information on this, seeNEWLINE_TOKEN*Policy on neutral point of viewNEWLINE_TOKEN*Guideline on spamNEWLINE_TOKEN*Guideline on external linksNEWLINE_TOKEN*Guideline on conflict of interestNEWLINE_TOKENIf you still have questions, there is a new contributor's help page, or you can write {{helpme}} below this message along with a question and someone will be along to answer it shortly.  You may also find the following pages useful for a general introduction to Wikipedia.NEWLINE_TOKEN*The five pillars of WikipediaNEWLINE_TOKEN*How to edit a pageNEWLINE_TOKEN*Help pagesNEWLINE_TOKEN*TutorialNEWLINE_TOKEN*How to write a great articleNEWLINE_TOKEN*Manual of StyleNEWLINE_TOKENI hope you enjoy editing Wikipedia!  Please sign your name on talk pages using four tildes (~~~~); this will automatically produce your name and the date. Feel free to write a note on the bottom of my talk page if you want to get in touch with me. Again, welcome!    "]
year (numeric, 16 distinct): ['2006', '2007', '2008', '2009', '2010', '2011', '2012', '2015', '2014', '2013']
logged_in (nominal, 2 distinct): ['1', '0']
ns (string, 2 distinct): ['user', 'article']
sample (string, 2 distinct): ['blocked', 'random']
split (string, 3 distinct): ['train', 'test', 'dev']
worker_id (numeric, 2190 distinct): ['11', '62', '328', '344', '217', '270', '518', '398', '196', '168']
gender (string, 3 distinct): ['male', 'female', 'other']
english_first_language (numeric, 2 distinct): ['0', '1']
age_group (string, 5 distinct): ['18-30', '30-45', '45-60', 'Under 18', 'Over 60']
education (string, 7 distinct): ['bachelors', 'hs', 'masters', 'professional', 'some', 'doctorate', 'none']
'''

CONTEXT = "Wikipedia Talk - Attacks Labels"
TARGET = CuratedTarget(raw_name="class", task_type=SupervisedTask.MULTICLASS)
COLS_TO_DROP = []
FEATURES = []